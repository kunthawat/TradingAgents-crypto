# ðŸ“„ TradingAgents Crypto - Report API Guide

## Overview

The new `/api/report` endpoint allows you to retrieve AI-generated trading analysis reports for completed sessions. This endpoint provides access to the actual content generated by the trading agents, not just status information.

## ðŸš€ Quick Start

### 1. Start Analysis
```bash
curl -X POST "http://localhost:5001/api/start_analysis" \
  -H "Content-Type: application/json" \
  -d '{
    "ticker": "BTC",
    "analysis_date": "2025-11-24",
    "analysts": ["market", "news", "fundamentals"],
    "research_depth": 2,
    "llm_provider": "openai",
    "shallow_thinker": "deepseek-ai/DeepSeek-R1-0528",
    "deep_thinker": "deepseek-ai/DeepSeek-R1-0528",
    "language": "english",
    "secret_pass": "your_secret_password_here"
  }'
```

### 2. Monitor Progress
```bash
curl "http://localhost:5001/api/status?session_id=YOUR_SESSION_ID"
```

### 3. Get Reports (when completed)
```bash
curl "http://localhost:5001/api/report?session_id=YOUR_SESSION_ID&section=all"
```

## ðŸ“‹ Available Endpoints

### GET /api/report

Retrieve AI-generated report content for a specific session.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| session_id | string | Yes | The session ID from start_analysis |
| section | string | No | Report section to retrieve (default: "all") |

#### Available Sections

| Section | Description |
|---------|-------------|
| `all` | All completed report sections |
| `market` | Market analysis report |
| `news` | News analysis report |
| `fundamentals` | Fundamentals analysis report |
| `sentiment` | Social sentiment analysis report |
| `investment_plan` | Research team investment plan |
| `trader_plan` | Trader investment plan |
| `final_decision` | Final trade decision |

#### Response Format

```json
{
  "session_id": "1763957983",
  "status": "completed",
  "requested_section": "all",
  "reports": {
    "market": "AI-generated market analysis content...",
    "news": "AI-generated news analysis content...",
    "fundamentals": "AI-generated fundamentals analysis content...",
    "sentiment": "AI-generated sentiment analysis content...",
    "investment_plan": "AI-generated investment plan content...",
    "trader_plan": "AI-generated trader plan content...",
    "final_decision": "AI-generated final decision content..."
  },
  "metadata": {
    "ticker": "BTC",
    "analysis_date": "2025-11-24",
    "completed_at": "1763957983"
  }
}
```

## ðŸ”§ Usage Examples

### Get All Reports
```bash
curl "http://localhost:5001/api/report?session_id=1763957983&section=all"
```

### Get Specific Report Section
```bash
curl "http://localhost:5001/api/report?session_id=1763957983&section=market"
```

### Get Market Analysis Only
```bash
curl "http://localhost:5001/api/report?session_id=1763957983&section=market"
```

### Get Final Trade Decision
```bash
curl "http://localhost:5001/api/report?session_id=1763957983&section=final_decision"
```

## ðŸ›¡ï¸ Error Handling

### Session Not Found (404)
```json
{
  "error": "Session not found"
}
```

### Analysis Not Completed (400)
```json
{
  "error": "Analysis not completed yet",
  "status": "running",
  "progress": 45
}
```

### Invalid Section (400)
```json
{
  "error": "Invalid section. Must be one of: all, market, news, fundamentals, sentiment, investment_plan, trader_plan, final_decision"
}
```

### Missing Session ID (400)
```json
{
  "error": "session_id parameter is required"
}
```

### Report Section Not Available (404)
```json
{
  "error": "Report section \"news\" not available or not completed yet"
}
```

## ðŸ”„ Complete Workflow

### 1. Start Analysis
```bash
# Start BTC analysis
response=$(curl -s -X POST "http://localhost:5001/api/start_analysis" \
  -H "Content-Type: application/json" \
  -d '{
    "ticker": "BTC",
    "analysis_date": "2025-11-24",
    "analysts": ["market", "news", "fundamentals"],
    "research_depth": 2,
    "llm_provider": "openai",
    "shallow_thinker": "deepseek-ai/DeepSeek-R1-0528",
    "deep_thinker": "deepseek-ai/DeepSeek-R1-0528",
    "language": "english",
    "secret_pass": "your_secret_password_here"
  }')

session_id=$(echo $response | jq -r '.session_id')
echo "Started analysis: $session_id"
```

### 2. Monitor Progress
```bash
# Wait for completion
while true; do
  status=$(curl -s "http://localhost:5001/api/status?session_id=$session_id")
  analysis_status=$(echo $status | jq -r '.status')
  progress=$(echo $status | jq -r '.progress')
  
  echo "Status: $analysis_status ($progress%)"
  
  if [ "$analysis_status" = "completed" ]; then
    echo "Analysis completed!"
    break
  elif [ "$analysis_status" = "failed" ]; then
    echo "Analysis failed!"
    exit 1
  fi
  
  sleep 10
done
```

### 3. Retrieve Reports
```bash
# Get all reports
curl -s "http://localhost:5001/api/report?session_id=$session_id&section=all" | jq .

# Get specific sections
for section in market news fundamentals final_decision; do
  echo "=== $section Report ==="
  curl -s "http://localhost:5001/api/report?session_id=$session_id&section=$section" | jq -r '.reports["'$section'"]'
  echo ""
done
```

## ðŸ§ª Testing

### Quick Test
```bash
python3 quick_api_test.py
```

### Comprehensive Report Test
```bash
python3 test_report_api.py
```

### Manual Testing
```bash
# Test error handling
curl "http://localhost:5001/api/report" | jq .
curl "http://localhost:5001/api/report?session_id=invalid" | jq .
curl "http://localhost:5001/api/report?session_id=invalid&section=invalid" | jq .
```

## ðŸ“Š Report Sections Explained

### Market Report
- Technical analysis
- Price trends
- Market indicators
- Trading signals

### News Report
- Recent news analysis
- Market sentiment from news
- Impact assessment
- News-driven insights

### Fundamentals Report
- Financial metrics
- On-chain analysis
- Project fundamentals
- Valuation insights

### Sentiment Report
- Social media analysis
- Community sentiment
- Reddit/Twitter analysis
- Sentiment trends

### Investment Plan
- Research team recommendation
- Bull vs Bear analysis
- Risk assessment
- Investment strategy

### Trader Plan
- Trading strategy
- Entry/exit points
- Risk management
- Position sizing

### Final Decision
- Portfolio manager decision
- Final recommendation
- Action plan
- Confidence level

## ðŸ” Integration Examples

### Python Integration
```python
import requests
import json
import time

def get_analysis_report(ticker="BTC"):
    base_url = "http://localhost:5001"
    
    # Start analysis
    response = requests.post(f"{base_url}/api/start_analysis", json={
        "ticker": ticker,
        "analysis_date": "2025-11-24",
        "analysts": ["market", "news", "fundamentals"],
        "research_depth": 2,
        "llm_provider": "openai",
        "shallow_thinker": "deepseek-ai/DeepSeek-R1-0528",
        "deep_thinker": "deepseek-ai/DeepSeek-R1-0528",
        "language": "english",
        "secret_pass": "your_secret_password_here"
    })
    
    session_id = response.json()['session_id']
    
    # Wait for completion
    while True:
        status = requests.get(f"{base_url}/api/status?session_id={session_id}").json()
        if status['status'] == 'completed':
            break
        time.sleep(10)
    
    # Get all reports
    reports = requests.get(f"{base_url}/api/report?session_id={session_id}&section=all").json()
    return reports

# Usage
reports = get_analysis_report("BTC")
print(json.dumps(reports, indent=2))
```

### JavaScript Integration
```javascript
async function getAnalysisReport(ticker = 'BTC') {
    const baseUrl = 'http://localhost:5001';
    
    // Start analysis
    const startResponse = await fetch(`${baseUrl}/api/start_analysis`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            ticker,
            analysis_date: '2025-11-24',
            analysts: ['market', 'news', 'fundamentals'],
            research_depth: 2,
            llm_provider: 'openai',
            shallow_thinker: 'deepseek-ai/DeepSeek-R1-0528',
            deep_thinker: 'deepseek-ai/DeepSeek-R1-0528',
            language: 'english',
            secret_pass: 'your_secret_password_here'
        })
    });
    
    const { session_id } = await startResponse.json();
    
    // Wait for completion
    let status;
    do {
        const statusResponse = await fetch(`${baseUrl}/api/status?session_id=${session_id}`);
        status = await statusResponse.json();
        if (status.status !== 'completed') {
            await new Promise(resolve => setTimeout(resolve, 10000));
        }
    } while (status.status !== 'completed');
    
    // Get reports
    const reportsResponse = await fetch(`${baseUrl}/api/report?session_id=${session_id}&section=all`);
    return await reportsResponse.json();
}

// Usage
getAnalysisReport('BTC').then(reports => console.log(reports));
```

## ðŸš€ Production Considerations

### Rate Limiting
- Implement rate limiting for report requests
- Cache completed reports to reduce processing load

### Security
- Validate session ownership
- Implement authentication for report access
- Sanitize report content if needed

### Performance
- Reports can be large, consider pagination for very long content
- Implement compression for API responses
- Use streaming for very large reports

### Monitoring
- Track report generation success rates
- Monitor API response times
- Log report access patterns

## ðŸ“š Additional Resources

- [API Status Guide](API_STATUS_GUIDE.md) - Status monitoring endpoints
- [API Usage Guide](API_USAGE_COMPLETE_GUIDE.md) - Complete API documentation
- [Deployment Guide](DEPLOYMENT_FIX_GUIDE.md) - Production deployment
- [Troubleshooting Guide](API_TROUBLESHOOTING_GUIDE.md) - Common issues and solutions

---

**Note**: The `/api/report` endpoint only returns content for completed analyses. Use `/api/status` to monitor analysis progress before requesting reports.
